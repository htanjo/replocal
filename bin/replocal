#!/usr/bin/env node
'use strict';

var program = require('commander');
var chalk = require('chalk');
var Replocal = require('../lib');
var pkg = require('../package.json');

function exec(program) {

  if (!program.args.length) {
    console.error(chalk.red('No <hostname> specified'));
    program.help();
  }

  var options = {
    hostname: program.args[0],
    docroot: program.args[1],
    port: program.port
  };

  new Replocal(options);

};

program
  .version(pkg.version)
  .usage('[options] <hostname> [<directory>]')
  .description([
    '  Start proxy server for replacing web contents with local files.',
    '  Your current working directory will be mapped to document root by default.',
    '  If you want to change document root, set <directory> argument.'
  ].join('\n  '))
  .option('-p, --port <number>', 'port number of proxy server (default: 8888)', parseInt);

program.on('--help', function () {
  console.log('  Examples:');
  console.log('');
  console.log('    $ replocal example.com');
  console.log('    $ replocal --port=9999 example.com path/to/docroot');
  console.log('');
});

program.parse(process.argv);

exec(program);
